---
title: "VSCode Extension"
created: 2020-12-21T00:42:00.002+09:00
tags: ["VSCode"]
---
少し前に [Status Bar Title](https://marketplace.visualstudio.com/items?itemName=ksoichiro.vscode-status-bar-title) という VSCode Extension を作った。全然大したことないのだが、2020年ももう終わりに近づくのに今年は全然書いていなかったので記録しておく。

![](https://lh3.googleusercontent.com/kURSOpp-Lqkd8EMk_Dl4Q6-TMKlErV0ujGLEutF9xRLYCS0m0I2INIVXM0_ubMSxetGd_Wcuw5S2AFlI3CrJ5nCLaVil5wwcRnc88KA6FTjJU87FVBaUK6Wts6uF3ZjchWJA4us8329RaoI6uSf5ij0aKEcnVS3SwzDRWZ8TQC-YYr7E8s7zB9jR3f_yN2wfpRj1X2gv-zoaN1bCf8ZzJKqE7XnBT-5y4XlwtbnXmo_0BTjWt__Leb5B8nfi8g6XQvetVD7QTRhkBBO58FkrjsdabDR8WB_0YKmIgDcyu2y4UPRvYRPH72OBVd21JNiuBABcgcEWsccsTtrvT5yg6mB8RTx7y_Jwi_lyLxt_atZ01rD1cvjwW_YduETEY4sUjVvRt0DGDbIPuYHxP602wYq0bKrbmI0UKNF7GtDFL77hpdiuqTQTDuu686GNYd_uF3PaqU06wdc_3EP5VCC9nd6wKuy9VCWsPGdYhPiNmFQN4_azLUwGGT6h7_PpDuv7TQ74_tRfjQ3pJMH5qtBVrdDG2tsjparVaAQyjy3A1FkvgbKv56G8EswiZUU2P5wkfWWDTV3ps9GN9M7xR5VEiyOWK_HfoPEKDyCfa90krldfuieisKHA5_iQ3Ets1sc2_Ujy26j2aSxS6DiRClMe2gpwKGi7AMJFawBKZceiVD6Kl3Ml6FG92MjJSC-m3g=w510-h76-no)

## 作った理由

vim などのように terminal ベースのエディタを使っていると、作業領域が広く取れるのが良いなと思っていて、VSCode でも少しでも近づけられればと思ったところ [Customize UI](https://marketplace.visualstudio.com/items?itemName=iocave.customize-ui) という extension を見つけた。

これを使うと、Activity Bar (エクスプローラ、検索、等のメニューのアイコンが並んだバー) の位置を変えたり、タイトルバーを隠すことができる。

これは良いと思ったが、タイトルが出ていないと、複数のウィンドウを開いているときに今どのウィンドウが開いているのかわかりにくいという問題がある。

エクスプローラの上部に表示されているが、視認しにくいのと、エクスプローラ以外を表示していると見えない。

![](https://lh3.googleusercontent.com/7Vi6GQ9mwGEJYQgrbkpHA5dWIFqvW40WRXQ-Cl6EYiOg5phMndEijJPv5yXYbM2KliHT0bZvJw1XAkOPOIJSe3zPmBHbFYoIcOhEyZpZJ5BWVvQwRfOAn01tOKpS4APuSjXfDxEvW4mDeSQXIk7MEaL2PaeXm0IJhV-HXfUp-tjiu6Mm7Bhtv1fLMGNjoprC4uCZbbMb3Xmu4iVNBgyY3i1XGTzPwtyqtVB-fun5EvnzSPS9t2JGqPCfojOrgNfusqRuLXmmusI8DZDB65g35EGAYUcliFPurvCTXTG9IwsjoShtjPeeotWplG6c-juRVpf68Uve3iYZ2e9QafaM_SwrfAmNaDkAVevFS1TuCbtDbgt0oo7jBdN9ngpM_gFs4O7ujahkunI4ffxhFeqGDBfk6Z2yowzxc2fu7p_nMBssTJ3jz9rb-YEEcmimv1x9HW6cq4t2qPdoVFC_P-WoD3xtNf1-sGdm0ZSuOGPdsHYIjGTeIWDmRpDOTl_FylL9lY4PNZW6vH5ejwSitcNrcmJraZCGK1LU5Yi3YfrFAeCOYbOAdIMdGsfOIBOn20Hk3TZl3tKI5vyT-CcRFD0yguPT4hWVe_RnjOdbBnkpg2n2zbiGBMh-NIi4LktILZBXVUeBcBmjRQodZqoQPZR3CapQI4fne-TR2BQIM5iDfjTFlqKaRZsgHrqZAw0wog=w716-h144-no)

だったらタイトルバーを表示すれば良いのでは…と思うかもしれないが、タイトルバー非表示のほうが何かカッコいいなと思ってしまったのだよな…

そこで、ステータスバーにタイトル(プロジェクト名)を表示できれば良いと思ったのだが、標準機能にはないらしく、ちょうどよい extension も見つからなかったので、作ってみることにした。

## 結果

結果が以下。Gitのブランチ名(master)の左側に表示されている `memorandum` の部分がプロジェクト名。本当に表示だけで、クリックしても何も起きない。

![](https://lh3.googleusercontent.com/PBDv0QAEC8B2O4CTJ4uo97b5s-0kKwh0l2p8LwlRTeT93BosbcuuVUOsxYwvf2epBvsIsTFAEq4bqGkJigNAmPAE1shoz7GrvCuDl2o2UlNMN-8UfzcLcu_Wv6SUro5grYsYRNjlxH0x0iXoOQxBb_Em5pG4KpfkSSfCbPY_jiSuvSZvxKh6Y92xawljRBvrsZMO8e-YMONBJf171jUqJMsSL08hIGHeqC_76JXHwx8PMyGE7Bhjmbov0kgOsEI2nOBqA8tGVQ-FkKARBsXNQC6zy5sJdSTe4iiP9GhJ4XMV66v_5T6iLtOBF-UNwVPuw5T1w1LhibBC6dIW6HCpKsCc5q7WyVwaqqu412Qm6iqR6I6rgURT9xZpLWW91jFfDb3OfLzU1HO9zKD2j7O8qFZhHR2-HJVOvdwbmbd8THg9QRYXFZ8pjLC8seIVTtWqBRNrRtmNrLOhJtp0DHpSS3-mwpKMsV7KqX6mo3QvFsAumm-7kjcK9Qf6WWkWSuJSbz4pvUJmURFDcU_V6Fo4kmiBUkY6XbZkngPFrJohs1YUag_CrpfP99DJRfrrUqutzB4Wkf72Rr21Fqop8_lEn2NJQnkCx7b2o11dexM1nb6Z5PW1ChNkjg1eRL9zhxB6YTmPNEO8CSnxCBi0WF5qbU6IxIzw443XIfBZC3JbJ-JZQq17xG3dR4S4HXEJew=w1476-h84-no)

ウィンドウ全体で見るとこんな感じ。目立たないが、同じ位置にあるとわかっていればそれなりに見分けられる。

![](https://lh3.googleusercontent.com/S0G78J2TST698eoS7JXz6gzDBQXiDPR-5pJHOVrgXI8E3B5xec2x6WQnU6AByKjpHVERU1SVJhko7WktEpOmoqGWtHnf012noEkw5SY0XOd-mjIQ9vQt7dx8dnFURujMycLLWL44VVPUNRihBKIZS6VZDbPkmJKGBkyQWF6cip7reEguAGojJD86WS3Ko-RpsPyk22_foRpW8Om6pWy_ZyebRCoPhx5-4NIpZ1Ud3rUrHQ5SnaBt85JgdrTxsj4imQ0idSxiffxyoFjSmJ8DdSpMgZyX7BZpFy14ikMQD5QPbxZI2z6zlu1M4nYAd4keEFv9gZk2iUJ9680tkoZAMO8IRzOeZz_qLOkd0FmEGL3GBiuZVsaw2eU0__yb3UQKqEQ_miHBxt7rZCiyAXkaFOii7WHkltlNdc0jL9CW3HnULFkernYCmHqf-IRq8aI-SKCphs6dRznUuSg7k8FzYX8zO2eSlnZ0nT5tOOVWEE7F0pKi44aeCzlYTOuwvexBkQa7y175QmdZg5sBii-2UOii0C5PutHEPgclB7G8u_UKhNQShOrCc0XNfV8NGalOhAsoWZyHtqTiTKqLuEUhvjx6LAyzT6raGQTmjejiXcGmD5u-SJgEUjk7-OA3Ifp3mJKuNZi19DND1BoLdbcK1LiGoY9JvH7wNntc3dTz6SWJHG7sBgz1a-NcCcp2sg=w3102-h1896-no)

extension のデバッグのウィンドウ(Extension Development Host)の場合はアイコンがbugのアイコンに変わる (これはextensionの開発者向けの相当に地味な機能…)。

![](https://lh3.googleusercontent.com/jlkwHL8zbYzsHNktiR0WFhDN3_35UtYcKB_MCJLcuFHNToLn5olZzrg2o5r4Hgh1vO3hv3WIqo4rAm2rHrhnjclMck1aDwmGKv1adU4W0CJSIj2o12O1AoosSkO3KScQArv0uijbV62hYvWfvUf6A5oJ2dG5oxan4D6r1tSUVCCrJpbEaLejOwXf1NqSCmWwrnzmOtmszBSsBTmUMghuPLLIRPlJBTEjxkYf8zOytGlzzYvGItzUC8lWut722sul03qRAhV4CC9L2laVLoS3Akh35-ETRLu0Z0P57l1x8QGj7h-dj-DB18Zxs0VeNpJndcUeWQUrYTZDLQSlLW3SqmsdjVknX3wzz_acWm-7vT5e27kDQwm-NUbqezIS8qivA-6bny-aYzcYk6ZLRjAc-bqSd12Yt3-y5gYTBpciJQRYgayfp5ik3hpw0nvbOMhZaPMtbMWzEoojhci5s1Ft7YlLQLWI7khh9O-85hlfXyOMgvLt4k-7fw3aIxNHAkR9lFbHT9-eteZd-mBoifnxUJbOjgJimQWFPI08Vi9QvZr2teOrSghhD17UM2rpwT9HljBB3uO1MBEiVyjX4DBNf-meeHtTOpjqeROH6UZC_hd1gALzVTxbETLoQ8n73MmA-8sLrvOCCJ60ivN-82zpm0BgKfwPdzV3CXVmLlL8XVaIWDL3sgsXJ4L13RVfxA=w660-h64-no)

こんな地味なもの使う人は自分くらい…とも思ったが、わずかながらダウンロードしてくれている人がいる。(最初の5~8件くらいは自分)

![](https://lh3.googleusercontent.com/2o-XN85wAcmYe_TI85bKf3pqfDPWtZWZ0_EpueIoVJctj9KbKctL-mwsQdg7jfIDjBbqa6vh6pOPIlwrfQ4tBex9qJM4sejzbORleExfbnVL8Zt-J-P1U6CltE706BqXvcVj5cSxtCPqNU7cHIC374mpevmeU0B2STSrxWaDDmR8KlL5iyoqM5f-HG_JsgR4a25mHYpNLMODIhVcff7gPXLZxruJltSseVSBjzU4RNnChXcOT1HnW5Qb9P4ZhKxYKh_Y1SnUa6Yj1Cc8n1ONeiDULiWDdsWhmsygpm4ZM7-13esPOzlrO8mSRfz6HEPzoiX3RZ-lhcwmvj98bskd2rvn-JhiyKiho_pDeZ7TdVLZPGSONrkvTPE4m0yk4X0-4ZYnGMXSaIREDpi_x-nm4b4mQk9C_6H7YgUlaAV1C4uCdVEpYvgk6dzeRoztzoLbnwf1v77_pGh_mwkjzRnzveA9g3WGQsXJPiVtqEYo8n1Alma1Oove8hryYJMmT12xL2xZ6xDS8poAdCkjeKTu47dAEm5Bq4jvzCVjqBoHUFXtLy-2rKiN4DAQtwbDQcG24NWwERh0Oi1exllcKA6FGz33oITEWsrp1KGZfvu6jEzk84QGeCc2l3O3XUt3TrmNqAlsWJx1f0z6Ht81tPycmfYRcRL6IeJNEhxAdxaGQuJiSbZaa7m8caYTQhPaxg=w868-h347-no)

リポジトリは [こちら](https://github.com/ksoichiro/vscode-status-bar-title)。

## 内容

本当に単純で、Hello Worldレベルな感じ。

起動とともに有効にしてほしいextensionなので、アクティベーションのイベントはすべて(`*`)。

```prism  json
"activationEvents": [  "*"],
```

activate の function で statusBarItem を作って登録する。

位置の制御のために優先度を示す整数値を与えるが、他のextensionがあっても基本的に一番左に表示したいという意味で大きい値を設定している。

```prism  typescript
myStatusBarItem = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left, 10000);context.subscriptions.push(myStatusBarItem);
```

あとは表示するitemを組み立てるだけ。

前述の通り Extension Development Hostかどうかという判定は [https://github.com/microsoft/vscode/issues/10272](https://github.com/microsoft/vscode/issues/10272) のworkaroundに頼っているが、それ以外は単純にworkspace名とアイコンを文字列で設定しているだけ。アイコンについては [Product Icon Reference](https://code.visualstudio.com/api/references/icons-in-labels) で説明されているが、 `$(project)` という文字列表現だけで簡単に設定できる。

```prism  typescript
const isDevelopment = vscode.env.sessionId === 'someValue.sessionId';const icon = isDevelopment ? '$(debug)' : '$(project)';const name = vscode.workspace.name;if (name) {	myStatusBarItem.text = `${icon} ${name}`;	myStatusBarItem.show();}
```

## リリース

細かな手順は様々なブログ等で説明されているので割愛するが、1点だけ。

ちょうどこの頃、GitHubではGitリポジトリのデフォルトブランチをmasterブランチではなくmainブランチとするようになった頃だったのだが、これに沿って main ブランチとしたところ、VSCode Extension の marketplace でうまく画像が出ないという事象に遭遇した。工夫をすれば回避できなくもなさそうだったが、その後も問題に遭遇しそうな気がしたので、まだ main にするのは早いかなと判断して master に戻した。
